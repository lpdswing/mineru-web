import{p as D,r as _,y as k,z as o,B as l,G as F,C as a,E as i,V as n,u as v,Q as P,W as J,U as C,X as N,Y as f,H as m}from"./element-plus-4BRiPEl_.js";import{f as T,g as S,a as W,b as $}from"./status-DoXMCZ5b.js";import{_ as A}from"./index-BdVRlj0D.js";import"./index-DLFCGwAH.js";import"./utils-TXqgcX9H.js";import"./user-DdPDo_0j.js";const H={class:"upload-root"},O={class:"upload-card"},Q={class:"upload-header"},X={key:0,class:"upload-list"},Y={class:"upload-list-header"},q={key:1},K={key:2},Z=D({__name:"Upload",setup(ee){const d=_([]),r=_(!1),c=_(!1),b=_(""),g=_(""),w=_(),U=t=>{if(!(t.size/1024/1024<200))return f.error("文件大小不能超过 200MB!"),!1;const p=[".pdf",".png",".jpg",".jpeg",".jp2",".webp",".gif",".bmp",".tiff"],u=t.name.toLowerCase().substring(t.name.lastIndexOf("."));return u===".xls"||u===".xlsx"?(f.error("不支持 Excel 文件上传！"),!1):p.includes(u)?!0:(f.error("不支持的文件类型！支持的格式：PDF、PNG、JPG、JPEG、JP2、WEBP、GIF、BMP、TIFF"),!1)},z=t=>{U(t.raw)&&d.value.push({name:t.name,size:t.size,status:"waiting",raw:t.raw})},x=t=>{const e=d.value.findIndex(p=>p.name===t.name);e!==-1&&d.value.splice(e,1)},E=()=>{g.value="";const t=b.value.trim();if(!t){g.value="请输入文档URL";return}if(!/^https?:\/\//.test(t)){g.value="请输入有效的URL（http/https）";return}const e=t.split("/").pop()||"远程文档.pdf";d.value.push({name:e,size:0,status:"waiting",url:t}),c.value=!1,b.value="",f.success("已添加到上传列表")},V=async()=>{var t;if(d.value.length===0){f.warning("请先选择要上传的文件");return}r.value=!0;try{const e=new FormData;d.value.forEach(u=>{u.raw&&e.append("files",u.raw)});const p=await $.uploadFiles(e);p&&p.total>0?(f.success("文件上传成功，已进入解析队列！"),d.value=[],(t=w.value)==null||t.clearFiles()):f.error("文件上传失败，请重试！")}catch{}finally{r.value=!1}};return(t,e)=>{const p=i("el-icon"),u=i("el-button"),B=i("el-upload"),y=i("el-table-column"),G=i("el-tag"),L=i("el-table"),M=i("el-empty"),I=i("el-input"),R=i("el-form-item"),h=i("el-form"),j=i("el-dialog");return m(),k("div",H,[o("div",O,[o("div",Q,[e[7]||(e[7]=o("span",{class:"upload-title"},"点击或拖拽上传文档",-1)),l(u,{class:"url-btn",type:"default",size:"small",plain:"",onClick:e[0]||(e[0]=s=>c.value=!0)},{default:a(()=>[l(p,null,{default:a(()=>e[5]||(e[5]=[o("link",null,null,-1)])),_:1,__:[5]}),e[6]||(e[6]=n(" URL 上传 "))]),_:1,__:[6]})]),l(B,{ref_key:"uploadRef",ref:w,class:"upload-area",drag:"",action:"/api/upload","auto-upload":!1,"on-change":z,"on-remove":x,"before-upload":U,accept:".pdf,.png,.jpeg,.jp2,.webp,.gif,.bmp,.jpg,.tiff",multiple:"",limit:20,disabled:r.value},{tip:a(()=>e[8]||(e[8]=[o("div",{class:"el-upload__tip"},[n(" 支持的文件类型：PDF、PNG、JPG、JPEG、JP2、WEBP、GIF、BMP、TIFF "),o("br"),n(" 单个文档不超过 "),o("b",null,"200M"),n(" 或 "),o("b",null,"600"),n(" 页，单图片不超过 "),o("b",null,"10M"),n("，单次最多 "),o("b",null,"20"),n(" 个文件 ")],-1)])),default:a(()=>[l(p,{class:"el-icon--upload"},{default:a(()=>[l(v(P))]),_:1}),e[9]||(e[9]=o("div",{class:"el-upload__text"},[n(" 拖拽文件到此处，或 "),o("span",{class:"upload-link"},"点击上传")],-1))]),_:1,__:[9]},8,["disabled"]),d.value.length>0?(m(),k("div",X,[o("div",Y,[e[10]||(e[10]=o("span",null,"待上传文件列表",-1)),l(u,{type:"primary",onClick:V,loading:r.value,disabled:r.value||d.value.length===0,size:"small"},{default:a(()=>[r.value?J("",!0):(m(),F(p,{key:0},{default:a(()=>[l(v(P))]),_:1})),r.value?(m(),k("span",K,"上传中...")):(m(),k("span",q,"开始上传"))]),_:1},8,["loading","disabled"])]),l(L,{data:d.value,border:"",stripe:""},{default:a(()=>[l(y,{prop:"name",label:"文件名"}),l(y,{prop:"size",label:"大小",width:"120"},{default:a(({row:s})=>[n(C(v(T)(s.size)),1)]),_:1}),l(y,{label:"状态",width:"120"},{default:a(({row:s})=>[l(G,{type:v(S)(s.status)},{default:a(()=>[n(C(v(W)(s.status)),1)]),_:2},1032,["type"])]),_:1}),l(y,{label:"操作",width:"120"},{default:a(({row:s})=>[l(u,{type:"danger",link:"",onClick:le=>x(s),disabled:s.status==="uploading"||r.value},{default:a(()=>e[11]||(e[11]=[n(" 删除 ")])),_:2,__:[11]},1032,["onClick","disabled"])]),_:1})]),_:1},8,["data"])])):(m(),F(M,{key:1,description:"暂无待上传文件，快来体验智能解析吧！","image-size":100,class:"upload-empty"}))]),l(j,{modelValue:c.value,"onUpdate:modelValue":e[4]||(e[4]=s=>c.value=s),title:"URL 上传",width:"400px","close-on-click-modal":!1},{footer:a(()=>[l(u,{onClick:e[3]||(e[3]=s=>c.value=!1)},{default:a(()=>e[12]||(e[12]=[n("取消")])),_:1,__:[12]}),l(u,{type:"primary",onClick:E},{default:a(()=>e[13]||(e[13]=[n("添加到上传列表")])),_:1,__:[13]})]),default:a(()=>[l(h,{onSubmit:e[2]||(e[2]=N(()=>{},["prevent"]))},{default:a(()=>[l(R,{label:"文档URL",error:g.value},{default:a(()=>[l(I,{modelValue:b.value,"onUpdate:modelValue":e[1]||(e[1]=s=>b.value=s),placeholder:"请输入文档下载地址",clearable:""},null,8,["modelValue"])]),_:1},8,["error"])]),_:1})]),_:1},8,["modelValue"])])}}}),ie=A(Z,[["__scopeId","data-v-0578fb0e"]]);export{ie as default};
